"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.transform = exports.parse = void 0;
const utils_js_1 = require("../utils.js");
const parse = (url) => {
    const parsedUrl = (0, utils_js_1.toUrl)(url);
    const fit = parsedUrl.searchParams.get("fit") || undefined;
    const width = (0, utils_js_1.getNumericParam)(parsedUrl, "wid");
    const height = (0, utils_js_1.getNumericParam)(parsedUrl, "hei");
    const quality = (0, utils_js_1.getNumericParam)(parsedUrl, "qlt") || undefined;
    const format = parsedUrl.searchParams.get("fmt") || undefined;
    const scale = (0, utils_js_1.getNumericParam)(parsedUrl, "scl") || undefined;
    return {
        width,
        height,
        format,
        base: parsedUrl.toString(),
        params: { fit, quality, scale },
        cdn: "scene7",
    };
};
exports.parse = parse;
const transform = ({ url: originalUrl, width, height, format }) => {
    const url = (0, utils_js_1.toUrl)(originalUrl);
    (0, utils_js_1.setParamIfDefined)(url, "wid", width, true, true);
    (0, utils_js_1.setParamIfDefined)(url, "hei", height, true, true);
    (0, utils_js_1.setParamIfDefined)(url, "fmt", format, true);
    (0, utils_js_1.setParamIfDefined)(url, "qlt", (0, utils_js_1.getNumericParam)(url, "qlt"), true);
    (0, utils_js_1.setParamIfDefined)(url, "scl", (0, utils_js_1.getNumericParam)(url, "scl"), true);
    (0, utils_js_1.setParamIfUndefined)(url, "fit", "crop");
    if (!width && !height) {
        (0, utils_js_1.setParamIfUndefined)(url, "scl", 1);
    }
    return url;
};
exports.transform = transform;
